
manifest {
    homePage = 'https://github.com/icgc-argo-workflows/argo-modules'
    description = 'ARGO Generic Modules to be shared across workflows for RDPC processing'
    nextflowVersion = '>=22.10.0'
}

params {
    outdir = "output/"
    publish_dir_mode = "copy"
    singularity_pull_docker_container = false
    test_data_base = './tests/data/qa'
}

process {
    cpus = 2
    memory = 3.GB
    time = 2.h
      ext.args = {[
        "song_url": params.song_url,
        "score_url": params.score_url,
        "transport_parallel": params.transport_parallel,
        "transport_mem": params.transport_mem,
        "api_token": params.api_token
      ]}
      ext.prefix = ""
      ext.max_retries = 1
      ext.first_retry_wait_time = 60
      ext.song_container_version = ""
      ext.song_container = ""
      publishDir = { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" }
}

profiles {
  singularity {
    docker.enabled = false
    singularity.enabled = true
    singularity.autoMounts = true
    singularity.engineOptions = '-s'
  }
  docker {
    docker.enabled = true
    singularity.enabled = false
    docker.runOptions = '-u \$(id -u):\$(id -g)'    
  }
  debug_qa {
      params.song_url      = 'https://submission-song.rdpc-qa.cancercollaboratory.org'
      params.score_url     = 'https://submission-score.rdpc-qa.cancercollaboratory.org'
  }
  debug_dev {
      params.song_url      = 'https://submission-song.rdpc-dev.cancercollaboratory.org'
      params.score_url     = 'https://submission-score.rdpc-dev.cancercollaboratory.org'
  }
  collab {
    params.song_url      = 'https://submission-song.rdpc.cancercollaboratory.org'
    params.score_url     = 'https://submission-score.rdpc.cancercollaboratory.org'
  }
}

// Load test_data.config containing paths to test data
//includeConfig 'test_data.config'
